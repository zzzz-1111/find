<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>倒计时功能</title>
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.3.0/dist/av-min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 50px;
            background-color: #f4f4f9;
        }
        h1 {
            color: #333;
        }
        .countdown {
            font-size: 2rem;
            color: #007BFF;
        }
    </style>
</head>
<body>
    <h1>活动倒计时</h1>
    <div class="countdown" id="countdown">加载中...</div>

    <script>
        // 初始化 LeanCloud
        AV.init({
            appId: 'a4O2WP8ZKjkOH8RbLNXgLTAE-gzGzoHsz',
            appKey: 'At7BrmqGKGPqcbHXwtEL6Y3e',
            serverURLs: 'https://a4o2wp8z.lc-cn-n1-shared.com',
        });

        async function getCountdown() {
            const query = new AV.Query('Round');
            query.descending('times'); // 按 times 降序排列
            query.limit(1); // 获取 times 最大的条目

            try {
                const result = await query.first();
                if (result) {
                    const endTime = new Date(result.get('end')); // 获取结束时间
                    startCountdown(endTime);
                } else {
                    document.getElementById('countdown').innerText = '未找到倒计时数据';
                }
            } catch (error) {
                console.error('Error fetching countdown:', error);
                document.getElementById('countdown').innerText = '加载失败';
            }
        }

        function startCountdown(endTime) {
            function updateCountdown() {
                const now = new Date();
                const timeRemaining = endTime - now;

                if (timeRemaining <= 0) {
                    document.getElementById('countdown').innerText = '活动已结束';
                    clearInterval(interval);
                    return;
                }

                const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);

                document.getElementById('countdown').innerText =
                    `${hours} 小时 ${minutes} 分钟 ${seconds} 秒`;
            }

            updateCountdown(); // 初始化更新
            const interval = setInterval(updateCountdown, 1000); // 每秒更新一次
        }

        getCountdown();
    </script>
</body>
</html>
